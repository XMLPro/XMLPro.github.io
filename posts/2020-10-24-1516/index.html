<!DOCTYPE html>
<html class="no-js" lang="ja">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Flutterã®Hybrid Compositionã‚’ä½¿ã£ãŸè©± - XMLPro</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="æ±äº¬å·¥ç§‘å¤§å­¦ç´…è¯ç¥­ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼">
		<meta property="og:title" content="Flutterã®Hybrid Compositionã‚’ä½¿ã£ãŸè©±" />
<meta property="og:description" content="æ±äº¬å·¥ç§‘å¤§å­¦ç´…è¯ç¥­ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://xmlpro.github.io/posts/2020-10-24-1516/" />
<meta property="article:published_time" content="2017-08-21T00:00:00+00:00" />
<meta property="article:modified_time" content="2017-08-21T00:00:00+00:00" />

		<meta itemprop="name" content="Flutterã®Hybrid Compositionã‚’ä½¿ã£ãŸè©±">
<meta itemprop="description" content="æ±äº¬å·¥ç§‘å¤§å­¦ç´…è¯ç¥­ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼">
<meta itemprop="datePublished" content="2017-08-21T00:00:00+00:00" />
<meta itemprop="dateModified" content="2017-08-21T00:00:00+00:00" />
<meta itemprop="wordCount" content="5737">



<meta itemprop="keywords" content="Flutter," />

		<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Flutterã®Hybrid Compositionã‚’ä½¿ã£ãŸè©±"/>
<meta name="twitter:description" content="æ±äº¬å·¥ç§‘å¤§å­¦ç´…è¯ç¥­ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼"/>

	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'G-QWXBQV3SFD', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

    
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T35HXQQ');</script>

</head>
<body class="body">
    
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T35HXQQ"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="XMLPro" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">XMLPro</div>
					<div class="logo__tagline">æ±äº¬å·¥ç§‘å¤§å­¦ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚µãƒ¼ã‚¯ãƒ«</div>
				</div>
		</a>
	</div>
		
<nav class="menu">
	<button class="menu__btn" aria-haspopup="true" aria-expanded="false" tabindex="0">
		<span class="menu__btn-title" tabindex="-1">ãƒ¡ãƒ‹ãƒ¥ãƒ¼</span>
	</button>
	<ul class="menu__list">
		<li class="menu__item">
			<a class="menu__link" href="/blogs/">
				
				<span class="menu__text">Blogs</span>
				
			</a>
		</li>
		<li class="menu__item menu__item--active">
			<a class="menu__link" href="/posts/">
				
				<span class="menu__text">Posts</span>
				
			</a>
		</li>
	</ul>
</nav>

	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Flutterã®Hybrid Compositionã‚’ä½¿ã£ãŸè©±</h1>
			<p class="post__lead">Flutterçµ„ã¿è¾¼ã¿ã®Widgetã§æ¸ˆã‚€ãªã‚‰ãã‚ŒãŒä¸€ç•ªã„ã„ã¨æ€ã†</p>
			
		</header>
<div class="post__toc toc">
	<div class="toc__title">ç›®æ¬¡</div>
	<div class="toc__menu">
		<nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#ã¯ã˜ã‚ã«">ã¯ã˜ã‚ã«</a></li>
        <li><a href="#ãã‚‚ãã‚‚ãªã‚“ã§ãƒã‚¤ãƒ†ã‚£ãƒ–ã®ãƒ“ãƒ¥ãƒ¼ãŒå¿…è¦ã«ãªã£ãŸã®">ãã‚‚ãã‚‚ãªã‚“ã§ãƒã‚¤ãƒ†ã‚£ãƒ–ã®ãƒ“ãƒ¥ãƒ¼ãŒå¿…è¦ã«ãªã£ãŸã®ï¼Ÿ</a></li>
        <li><a href="#hybrid-compositionã¨ã¯">Hybrid Compositionã¨ã¯</a></li>
        <li><a href="#ä½¿ã„æ–¹">ä½¿ã„æ–¹</a></li>
        <li><a href="#æœ¬é¡Œ">æœ¬é¡Œ</a></li>
        <li><a href="#æ„Ÿæƒ³ã¨ã‹æ³¨æ„ã¨ã‹">æ„Ÿæƒ³ã¨ã‹ã€æ³¨æ„ã¨ã‹</a></li>
      </ul>
    </li>
  </ul>
</nav>
	</div>
</div>
<div class="content post__content clearfix">
			<h3 id="ã¯ã˜ã‚ã«">ã¯ã˜ã‚ã«</h3>
<p>à¸ªà¸§à¸±à¸ªà¸”à¸µà¸•à¸­à¸™à¹€à¸Šà¹‰à¸²ğŸ™ã€‚ã¿ã‚“ãªã ã„ã™ãéƒ¨é•·<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>ã®ç®±å®ˆç”±ã§ã™ã£â˜†ã€‚ä»Šæ—¥ã¯ã¿ã‚“ãªã¨ä¸€ç·’ã«ãƒ–ãƒ­ã‚°ã‚’æ›¸ã„ã¦ã„ãã‚ˆï¼<sup id="fnref:2"><a href="#fn:2" class="footnote-ref" role="doc-noteref">2</a></sup> ã¿ã‚“ãªãŒä½•æ—¥ç›®ã‚’ã‚„ã‚‹ã¨ã‹æ±ºã‚ã¦ãªã„ã‹ã‚‰ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã¨å‘¼ã¹ãªã„ã®â€¦ğŸ¥ºã´ãˆã‚“<sup id="fnref:3"><a href="#fn:3" class="footnote-ref" role="doc-noteref">3</a></sup></p>
<p>ä»Šå›ã¯Flutterã®hybrid-compositionã«è§¦ã‚Œã‚‹ã“ã¨ãŒã‚ã£ãŸã®ã§ãã‚Œã«ã¤ã„ã¦è¨˜äº‹ã‚’æ›¸ã“ã†ã¨æ€ã„ã¾ã™ã€‚èª¿ã¹ã¦ã‚‚æƒ…å ±ã‚‚ãƒ‡ãƒ¢ã¨ãªã‚‹ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚‚ã‚ã¾ã‚Šè¦‹å½“ãŸã‚‰ãªã‹ã£ãŸã®ã§ã ã‚Œã‹ã®å‚è€ƒã«ãªã‚Œã°å¹¸ã„ã§ã™ã€‚</p>
<h3 id="ãã‚‚ãã‚‚ãªã‚“ã§ãƒã‚¤ãƒ†ã‚£ãƒ–ã®ãƒ“ãƒ¥ãƒ¼ãŒå¿…è¦ã«ãªã£ãŸã®">ãã‚‚ãã‚‚ãªã‚“ã§ãƒã‚¤ãƒ†ã‚£ãƒ–ã®ãƒ“ãƒ¥ãƒ¼ãŒå¿…è¦ã«ãªã£ãŸã®ï¼Ÿ</h3>
<p>å€‹äººçš„ã«ã¯Flutterã¯ã‹ãªã‚Šä½¿ã„å‹æ‰‹ãŒã‚ˆãã»ã¨ã‚“ã©Flutterçµ„ã¿è¾¼ã¿ã®Widgetã§å•é¡Œãªã„ã¨æ€ã£ã¦ã„ã¾ã™ã€‚ãŸã ã€ã©ã†ã—ã¦ã‚‚æ°—ã«å…¥ã‚‰ãªã„ã®ãŒãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æ—¥æœ¬èªå…¥åŠ›ã®æŒ™å‹•ã§ã™ã€‚ä¸‹ã®ç”»åƒã‚’è¦‹ã¦ãã ã•ã„ã€‚</p>
<figure class="center">
    <img src="./flutter-textfield.png" width="320"/> <figcaption>
            <h4>Flutterçµ„ã¿è¾¼ã¿ã®TextField</h4>
        </figcaption>
</figure>

<p>ã€Œã¶ã‚“ã‹ã¤ã¸ã‚“ã‹ã‚“ã€ã¨å…¥åŠ›ã—ãŸå¾Œã€å·¦ã¸ç§»å‹•ã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ã‚«ãƒ¼ã‚½ãƒ«ã‚’ç§»å‹•ã•ã›ã‚‹ã¨å¤‰æ›ç¯„å›²ã¨Flutterä¸Šã§è¡¨ç¤ºã•ã‚Œã‚‹å¤‰æ›ç¯„å›²ãŒä¸€è‡´ã—ãªããªã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã‚ã¾ã‚Šç›´æ„Ÿçš„ã¨ã¯è¨€ãˆã¾ã›ã‚“ã€‚</p>
<p>ã„ã‚ã„ã‚ã¨Flutterã®TextFieldã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¦‹ã¦ã¿ãŸã®ã§ã™ãŒã€ã¡ã‚‡ã†ã©ã„ã„è§£æ±ºç­–ãŒè¦‹ã¤ã‹ã‚‰ãšã€<strong>EditText</strong>ã¨ã„ã†Androidãƒã‚¤ãƒ†ã‚£ãƒ–ã®Viewã‚’ä½¿ãˆã°è§£æ±ºã™ã‚‹ã®ã§ã¯ãªã„ã‹ã¨æ€ã„ã¾ã—ãŸã€‚</p>
<h3 id="hybrid-compositionã¨ã¯">Hybrid Compositionã¨ã¯</h3>
<p>Hybrid Compositionã¨ã¯android.view.Viewã‚’Flutterã®ã‚¦ã‚£ã‚¸ãƒƒãƒˆãƒ„ãƒªãƒ¼ã«è¿½åŠ ã™ã‚‹ã“ã¨ã§Androidã®ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ“ãƒ¥ãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®ã—ãã¿ã§ã™ã€‚ã‚¦ã‚£ã‚¸ãƒƒãƒˆãƒ„ãƒªãƒ¼ã«çµ„ã¿è¾¼ã¾ã‚Œã¦ã„ã‚‹ã®ã§ã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãªã©ãŒã†ã¾ãå‹•ã„ã¦ãã‚Œã¾ã™ã€‚</p>
<p>Androidã®ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ“ãƒ¥ãƒ¼ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®ã‚‚ã®ã¨ã—ã¦AndroidViewã¨ã„ã†Flutterã®ã‚¦ã‚£ã‚¸ãƒƒãƒˆã‚’åˆ©ç”¨ã—ãŸãƒãƒ¼ãƒãƒ£ãƒ«ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã¨ã„ã†ã‚‚ã®ãŒã‚ã‚Šã¾ã™ãŒã€ã“ã‚Œã¯Androidãƒã‚¤ãƒ†ã‚£ãƒ–ã®ãƒ“ãƒ¥ãƒ¼ã®è¡¨ç¤ºçµæœã‚’Flutterã®ã‚¦ã‚£ã‚¸ãƒƒãƒˆã«è²¼ã‚Šä»˜ã‘ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã ã¨æ€ã„ã¾ã™ã€‚ãƒ“ãƒ¥ãƒ¼ã‚’è²¼ã‚Šä»˜ã‘ã¦ã„ã‚‹ã ã‘ãªã®ã§ã€ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒã†ã¾ãå‹•ã‹ãªã„ã“ã¨ãŒå¤šã„ã§ã™ã€‚ç§ã‚‚ã¯ã˜ã‚ã¯Hybrid Compositionã§ã¯ãªãAndroidViewã‚’ä½¿ã£ã¦ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚’å®Ÿè£…ã—ã¦ã„ãŸã®ã§ã™ãŒã€ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ã‚¿ãƒƒãƒã—ã¦ã‚‚ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãŒå‡ºã¦ãã‚Œãªãã¦å‘†ç„¶ã¨ã—ã¦ãŠã‚Šã¾ã—ãŸã€‚</p>
<p>å‚è€ƒï¼š<a href="https://flutter.dev/docs/development/platform-integration/platform-views">Flutterå…¬å¼</a></p>
<h3 id="ä½¿ã„æ–¹">ä½¿ã„æ–¹</h3>
<p>ä¸Šã®å‚è€ƒãƒªãƒ³ã‚¯ã«ã®ã£ã¦ã„ã‚‹ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®è§£èª¬ã‚’ã—ã¦ã„ã“ã†ã‹ãªã¨æ€ã„ã¾ã™ã€‚</p>
<h4 id="flutterã‚µã‚¤ãƒ‰">Flutterã‚µã‚¤ãƒ‰</h4>
<p>ã¾ãšã€Flutterå´ã‹ã‚‰å§‹ã‚ã¾ã™ã€‚</p>
<p>ä»¥ä¸‹ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-dart" data-lang="dart"><span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#39;package:flutter/foundation.dart&#39;</span>;
<span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#39;package:flutter/gestures.dart&#39;</span>;
<span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#39;package:flutter/rendering.dart&#39;</span>;
<span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#39;package:flutter/services.dart&#39;</span>;
</code></pre></div><p>Widgetã®build()ã§ã¯ä»¥ä¸‹ã‚’è¿”ã—ã¾ã™ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-dart" data-lang="dart">Widget build(BuildContext context) {
  <span style="color:#75715e">// This is used in the platform side to register the view.
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">String</span> viewType <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&lt;platform-view-type&gt;&#39;</span>;
  <span style="color:#75715e">// Pass parameters to the platform side.
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">final</span> Map<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">dynamic</span><span style="color:#f92672">&gt;</span> creationParams <span style="color:#f92672">=</span> <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">dynamic</span><span style="color:#f92672">&gt;</span>{};

  <span style="color:#66d9ef">return</span> PlatformViewLink(
    viewType: viewType,
    surfaceFactory:
        (BuildContext context, PlatformViewController controller) {
      <span style="color:#66d9ef">return</span> AndroidViewSurface(
        controller: controller,
        gestureRecognizers: <span style="color:#66d9ef">const</span> <span style="color:#f92672">&lt;</span>Factory<span style="color:#f92672">&lt;</span>OneSequenceGestureRecognizer<span style="color:#f92672">&gt;&gt;</span>{},
        hitTestBehavior: PlatformViewHitTestBehavior.opaque,
      );
    },
    onCreatePlatformView: (PlatformViewCreationParams params) {
      <span style="color:#66d9ef">return</span> PlatformViewsService.initSurfaceAndroidView(
        id: params.id,
        viewType: viewType,
        layoutDirection: TextDirection.ltr,
        creationParams: creationParams,
        creationParamsCodec: StandardMessageCodec(),
      )
        ..addOnPlatformViewCreatedListener(params.onPlatformViewCreated)
        ..create();
    },
  );
}
</code></pre></div><p>ã§ã¯ã€ä¸Šã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®è§£èª¬ã‚’ã—ã¦ã„ãã¾ã™ã€‚</p>
<p>viewTypeã¨ã„ã†ã®ã¯ãƒã‚¤ãƒ†ã‚£ãƒ–ã®ãƒ“ãƒ¥ãƒ¼ã‚’è­˜åˆ¥ã™ã‚‹ãŸã‚ã®æ–‡å­—åˆ—ã§ã™ã€‚ä»»æ„ã®åå‰ãŒä½¿ç”¨å¯èƒ½ã§ã™ã€‚</p>
<p>PlatformViewLink()ãŒFlutterã«çµ±åˆã•ã‚ŒãŸAndroidãƒã‚¤ãƒ†ã‚£ãƒ–ã®ãƒ“ãƒ¥ãƒ¼ã‚’ä½œæˆã—ã¦ãã‚Œã¦ã„ã‚‹ã£ã½ã„ã§ã™ã€‚</p>
<p>surfaceFactoryã¯Flutterã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ„ãƒªãƒ¼ã«çµ„ã¿è¾¼ã¾ã‚Œã‚‹ãƒ¬ã‚¤ãƒ¤ã‚’è¿”ã™é–¢æ•°ã‚’è¨­å®šã—ã¦ã‚ã’ã¾ã™ã€‚ä»Šå›ã¯Androidãƒã‚¤ãƒ†ã‚£ãƒ–ã®ãƒ¬ã‚¤ãƒ¤ã‚’ãƒ„ãƒªãƒ¼ã«è¿½åŠ ã—ãŸã„ã®ã§ã€AndroidViewSurfaceã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã£ã¦ã“ã¨ã£ã½ã„ã§ã™ã€‚gestureRecognizersã¯GestureRecognizerã®Factoryã®ãƒªã‚¹ãƒˆã‚’æ¸¡ã—ã¦ã‚„ã‚Šã¾ã™ã€‚ã“ã“ã«æ¸¡ã—ãŸGestureRecognizerã®Gestureã®ç¨®é¡ãŒAndroidãƒã‚¤ãƒ†ã‚£ãƒ–ã®ãƒ“ãƒ¥ãƒ¼ã«ã‚‚é€šçŸ¥ã•ã‚Œã‚‹ã£ã½ã„ã§ã™ã€‚hitTestBehaviorã¯ã‚¿ãƒƒãƒç¯„å›²ã«é–¢ã™ã‚‹è¨­å®šã§ã€ã©ã†ã„ã†ä½¿ã„æ–¹ãªã®ã‹ã¯<a href="https://qiita.com/najeira/items/54e3cfff16c82318103d">ã“ã¡ã‚‰</a>ãŒåˆ†ã‹ã‚Šã‚„ã™ã„ã‹ã‚‚ã§ã™ã€‚</p>
<p>onCreatePlatformViewã«ã¯PlatformViewCreationParamsã‚¯ãƒ©ã‚¹ã‚’å—ã‘å–ã£ã¦PlatformViewControllerã‚’è¿”ã™é–¢æ•°ã‚’æŒ‡å®šã—ã¾ã™ã€‚ã“ã®é–¢æ•°ã§ä½œã‚‰ã‚ŒãŸControllerãŒsurfaceFactoryã«æ¸¡ã•ã‚Œã¦ã€ãƒ¬ã‚¤ãƒ¤ã®ä½œæˆã«åˆ©ç”¨ã•ã‚Œã‚‹ã€‚PlatformViewsService.initSurfaceAndroidViewãŒSurfaceAndroidViewControllerã¨ã„ã†PlatformViewControllerã‚’ç¶™æ‰¿ã—ãŸã‚¯ãƒ©ã‚¹ã‚’è¿”ã—ã¦ã„ã¾ã™ã€‚</p>
<p>params.idã«ã¯ã“ã‚Œã‹ã‚‰ä½œã‚‰ã‚Œã‚‹Androidãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ“ãƒ¥ãƒ¼ã®idãŒå…¥ã£ã¦ã„ã¾ã™ã€‚
textDirectionã¯ãƒ†ã‚­ã‚¹ãƒˆã®å‘ãã‚’æ±ºå®šã—ã€creationPramsCodecã¯Androidã‚µã‚¤ãƒ‰ã«creationParamsã‚’é€ã‚‹å‰ã«ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã™ã‚‹ãŸã‚ã®ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã ãã†ã§ã™ï¼ˆèª¿ã¹ã¦ãªã„ã®ã§ã‚ˆãã‚ã‹ã‚‰ã‚“ï¼‰ã€‚creationParamsã¯ä½œæˆã™ã‚‹ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ“ãƒ¥ãƒ¼ã«æ¸¡ã•ã‚Œã¦è‡ªç”±ã«ä½¿ãˆã¾ã™ã€‚ï¼ˆå¾Œã®kotlinã‚³ãƒ¼ãƒ‰ã‚’å‚ç…§ï¼‰</p>
<p>addOnPlatformViewCreatedListenerã«params.onPlatformViewCreatedãŒæ¸¡ã•ã‚Œã¦ã„ã¾ã™ãŒã€ã“ã®onPlatformViewCreatedã¯ã€PlatformViewLinkã®setStateã‚’å‘¼ã¶ã ã‘ã®é–¢æ•°ã£ã½ã„ã§ã™ã€‚(å®Ÿè£…ã¯<a href="https://github.com/flutter/flutter/blob/720dff6a94bd054e82ec4bf84b5cb802bbc52ddd/packages/flutter/lib/src/widgets/platform_view.dart#L890">ã“ã“</a>) setStateã§_platformViewCreatedã‚’trueã«ã—ã¦ã„ã¾ã™ã€‚ã“ã‚ŒãŒtrueã«ãªã‚‹ã¨ã€build()ã§è¿”ã‚‹ã‚¦ã‚£ã‚¸ãƒƒãƒˆãŒSizedBox.expand()ã‹ã‚‰ã€Androidãƒã‚¤ãƒ†ã‚£ãƒ–ã®ãƒ¬ã‚¤ãƒ¤ãŒå…¥ã£ãŸFocusã‚¦ã‚£ã‚¸ãƒƒãƒˆãŒè¿”ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚</p>
<p>create()ã‚’å‘¼ã¶ã¨SystemChannelã‚’é€šã—ã¦Androidã®ãƒ“ãƒ¥ãƒ¼ãŒä½œæˆã•ã‚Œã¦(_sendCreateMessage() <a href="https://github.com/flutter/flutter/blob/720dff6a94bd054e82ec4bf84b5cb802bbc52ddd/packages/flutter/lib/src/services/platform_views.dart#L1019">å®Ÿè£…ã¯ã“ã“</a>)ã€ãƒªã‚¹ãƒŠãƒ¼ã¨ã—ã¦ç™»éŒ²ã•ã‚ŒãŸé–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚(<a href="https://github.com/flutter/flutter/blob/720dff6a94bd054e82ec4bf84b5cb802bbc52ddd/packages/flutter/lib/src/services/platform_views.dart#L740">ã“ã“</a>ãŒè©²å½“)</p>
<p>é•·ããªã£ãŸã®ã§ç°¡å˜ã«ã¾ã¨ã‚ç›´ã™ã¨ã€</p>
<ol>
<li>PlatformViewLinkã‚’ä½œã£ã¦ã‚„ã‚‹</li>
<li>PlatformViewLinkã‚’ä½œæˆã™ã‚‹ã¨ã€onCreatePlatformViewã«è¨­å®šã—ãŸé–¢æ•°ãŒå‘¼ã°ã‚Œã‚‹ã€‚</li>
<li>ãã®å‘¼ã°ã‚ŒãŸé–¢æ•°ã§ã¯Androidãƒã‚¤ãƒ†ã‚£ãƒ–ã®Viewã‚’ä½œæˆã—ã€ä½œæˆãŒçµ‚ã‚ã£ãŸã‚‰addOnPlatformViewCreatedListener()ã§ç™»éŒ²ã•ã‚ŒãŸé–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¦(setStateã‚’å‘¼ã³å‡ºã—ã¦)ã€PlatformViewLinkã®build()ã®å‡¦ç†ã®æµã‚Œã‚’å¤‰ãˆã‚‹</li>
<li>PlatformViewLinkã®build()å†…ã§ã€surfaceFactoryã‚’å‘¼ã³å‡ºã—ãŸéš›ã«è¿”ã•ã‚Œã‚‹AndroidViewSurfaceã‚’childã«æŒã¤Focusã‚¦ã‚£ã‚¸ãƒƒãƒˆãŒä½œæˆã•ã‚Œã€ãã‚ŒãŒè¡¨ç¤ºã•ã‚Œã‚‹ã€‚</li>
</ol>
<p>ã“ã†ã„ã†æµã‚Œã«ãªã‚Šã¾ã™ã€‚ã†ãƒ¼ã‚“ã€‚ã“ã‚Œã€Flutteråˆ©ç”¨è€…ã«æ›¸ã‹ã›ã‚‹ã‚³ãƒ¼ãƒ‰ã˜ã‚ƒãªã„ã ã‚&hellip;.</p>
<h4 id="ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚µã‚¤ãƒ‰">ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚µã‚¤ãƒ‰</h4>
<p>æ¬¡ã«ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚µã‚¤ãƒ‰ã®ã‚³ãƒ¼ãƒ‰ã‚’è¼‰ã›ã¾ã™ã€‚ã“ã‚Œã‚‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ç½®ãå ´ã§ã™ãŒã€android/app/src/main/kotlinä»¥ä¸‹ã‚’æ¢ã—ã¦ã„ãã¨MainActivity.ktã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚‹ã¨æ€ã„ã¾ã™ã€‚ãã“ã«ç½®ã„ã¦ãã ã•ã„ã€‚</p>
<p>NativeView.kt</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin:NativeView.kt" data-lang="kotlin:NativeView.kt"><span style="color:#66d9ef">package</span> dev.flutter.example

<span style="color:#66d9ef">import</span> android.content.Context
<span style="color:#66d9ef">import</span> android.graphics.Color
<span style="color:#66d9ef">import</span> android.view.View
<span style="color:#66d9ef">import</span> android.widget.TextView
<span style="color:#66d9ef">import</span> io.flutter.plugin.platform.PlatformView

<span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">NativeView</span>(context: Context, id: Int, creationParams: Map&lt;String?, Any?&gt;?) : PlatformView {
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> textView: TextView

    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">getView</span>(): View {
        <span style="color:#66d9ef">return</span> textView
    }

    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">dispose</span>() {}

    <span style="color:#66d9ef">init</span> {
        textView = TextView(context)
        textView.textSize = <span style="color:#ae81ff">72f</span>
        textView.setBackgroundColor(Color.rgb(<span style="color:#ae81ff">255</span>, <span style="color:#ae81ff">255</span>, <span style="color:#ae81ff">255</span>))
        textView.text = <span style="color:#e6db74">&#34;Rendered on a native Android view (id: </span><span style="color:#e6db74">$id</span><span style="color:#e6db74">)&#34;</span>
    }
}

</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin:NativeViewFactory.kt" data-lang="kotlin:NativeViewFactory.kt"><span style="color:#66d9ef">package</span> dev.flutter.example

<span style="color:#66d9ef">import</span> android.content.Context
<span style="color:#66d9ef">import</span> android.view.View
<span style="color:#66d9ef">import</span> io.flutter.plugin.common.BinaryMessenger
<span style="color:#66d9ef">import</span> io.flutter.plugin.common.StandardMessageCodec
<span style="color:#66d9ef">import</span> io.flutter.plugin.platform.PlatformView
<span style="color:#66d9ef">import</span> io.flutter.plugin.platform.PlatformViewFactory

<span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">NativeViewFactory</span>(<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> messenger: BinaryMessenger, <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> containerView: View) : PlatformViewFactory(StandardMessageCodec.INSTANCE) {
    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">create</span>(context: Context, id: Int, args: Any?): PlatformView {
        <span style="color:#66d9ef">val</span> creationParams = args <span style="color:#66d9ef">as</span> Map&lt;String?, Any?&gt;?
        <span style="color:#66d9ef">return</span> NativeView(context, id, creationParams)
    }
}
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin:MainActivity.kt" data-lang="kotlin:MainActivity.kt"><span style="color:#66d9ef">package</span> dev.flutter.example

<span style="color:#66d9ef">import</span> io.flutter.embedding.android.FlutterActivity
<span style="color:#66d9ef">import</span> io.flutter.embedding.engine.FlutterEngine

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MainActivity</span> : FlutterActivity() {
    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">configureFlutterEngine</span>(flutterEngine: FlutterEngine) {
        flutterEngine
                .platformViewsController
                .registry
                .registerViewFactory(<span style="color:#e6db74">&#34;&lt;platform-view-type&gt;&#34;</span>, NativeViewFactory())
    }
}
</code></pre></div><p>ãƒã‚¤ãƒ†ã‚£ãƒ–ã®æ–¹ã®ã‚³ãƒ¼ãƒ‰ã¯Flutterã‚µã‚¤ãƒ‰ã«æ¯”ã¹ã‚Œã°èª­ã¿ã‚„ã™ã„æ°—ãŒã—ã¾ã™ã­ã€‚Flutterã‚µã‚¤ãƒ‰ã‹ã‚‰viewTypeã®ãƒ“ãƒ¥ãƒ¼ã‚’åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã«ã¯3ã¤ã®æ‰‹é †ã‚’è¸ã¿ã¾ã™ã€‚</p>
<ol>
<li>PlatformViewã‚¯ãƒ©ã‚¹ã‚’ç¶™æ‰¿ã—ãŸãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ“ãƒ¥ãƒ¼ã‚’ä½œæˆã™ã‚‹
initç­‰ã§Androidãƒã‚¤ãƒ†ã‚£ãƒ–ã®ãƒ“ãƒ¥ãƒ¼ã‚’ä½œæˆã—ã€getViewã§ãã‚Œã‚’è¿”ã™ã‚ˆã†ã«è¨­å®šã™ã‚‹</li>
<li>NativeViewã‚’ä½œæˆã™ã‚‹Factoryã‚’ä½œæˆã™ã‚‹</li>
<li>MainActivityã®configureFlutterEngineå†…ã§registerViewFactoryã‚’å‘¼ã³å‡ºã—ã¦ã€viewTypeï¼ˆä»Šå›ã®ä¾‹ã ã¨&quot;&lt;platform-view-type&gt;&quot;ï¼‰ã¨ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ“ãƒ¥ãƒ¼ã‚’ç´ã¥ã‘ã‚‹ã€‚</li>
</ol>
<p>NativeViewFactoryã«creationParamsãŒæ¸¡ã£ã¦ãã¦ã„ã¾ã™ãŒã€ã“ã‚ŒãŒFlutterã‚µã‚¤ãƒ‰ã§æ¸¡ã—ãŸcreationParamsã§ã™ã€‚NativeViewã«ã“ã‚Œã‚’æ¸¡ã™ã“ã¨ã§ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒ“ãƒ¥ãƒ¼ã§ã‚‚åˆ©ç”¨ãŒã§ãã¾ã™ã€‚</p>
<h3 id="æœ¬é¡Œ">æœ¬é¡Œ</h3>
<p>ãªã‚“ã¨ãªãæµã‚ŒãŒåˆ†ã‹ã£ãŸã®ã§ã€å®Ÿéš›ã«ä¸Šã®ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ã£ã¦å¤‰æ›ç¯„å›²ãŒãã‚Œã„ãªãƒã‚¤ãƒ†ã‚£ãƒ–ã®ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚ã‚µãƒ³ãƒ—ãƒ«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯(ã“ã“)[https://github.com/hakomori64/hybrid-composition-textfield]ã«ç½®ã„ã¦ãŠãã¾ã™ã€‚</p>
<p>æœ€åˆã«Dartå´ã®ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-dart" data-lang="dart"><span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#39;dart:async&#39;</span>;
<span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#39;package:flutter/material.dart&#39;</span>;
<span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#39;package:flutter/foundation.dart&#39;</span>;
<span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#39;package:flutter/gestures.dart&#39;</span>;
<span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#39;package:flutter/rendering.dart&#39;</span>;
<span style="color:#66d9ef">import</span> <span style="color:#e6db74">&#39;package:flutter/services.dart&#39;</span>;


<span style="color:#66d9ef">void</span> main() {
  runApp(MyApp());
}

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MyApp</span> <span style="color:#66d9ef">extends</span> StatelessWidget {
  <span style="color:#75715e">// This widget is the root of your application.
</span><span style="color:#75715e"></span>  <span style="color:#960050;background-color:#1e0010">@</span>override
  Widget build(BuildContext context) {
    <span style="color:#66d9ef">return</span> MaterialApp(
      title: <span style="color:#e6db74">&#39;TextField Demo&#39;</span>,
      theme: ThemeData(
        primarySwatch: Colors.blue,
        visualDensity: VisualDensity.adaptivePlatformDensity,
      ),
      home: TextFieldDemo(title: <span style="color:#e6db74">&#39;Flutter Text Field Demo&#39;</span>),
    );
  }
}

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TextFieldDemo</span> <span style="color:#66d9ef">extends</span> StatefulWidget {
  TextFieldDemo({Key key, <span style="color:#66d9ef">this</span>.title}) <span style="color:#f92672">:</span> <span style="color:#66d9ef">super</span>(key: key);

  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">String</span> title;

  <span style="color:#960050;background-color:#1e0010">@</span>override
  _TextFieldDemoState createState() <span style="color:#f92672">=&gt;</span> _TextFieldDemoState();
}

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">_TextFieldDemoState</span> <span style="color:#66d9ef">extends</span> State<span style="color:#f92672">&lt;</span>TextFieldDemo<span style="color:#f92672">&gt;</span> {

  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">String</span> viewType <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;edit-text&#34;</span>;
  Map<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">dynamic</span><span style="color:#f92672">&gt;</span> creationParams <span style="color:#f92672">=</span> <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">dynamic</span><span style="color:#f92672">&gt;</span>{};
  <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">const</span> EventChannel _eventChannel <span style="color:#f92672">=</span> <span style="color:#66d9ef">const</span> EventChannel(<span style="color:#e6db74">&#34;events/edit-text&#34;</span>);
  StreamSubscription _streamSubscription;
  <span style="color:#66d9ef">String</span> text <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;

  <span style="color:#66d9ef">void</span> onTextChanged(<span style="color:#66d9ef">String</span> t) {
    print(<span style="color:#e6db74">&#34;setState Called&#34;</span>);
    setState(() {text <span style="color:#f92672">=</span> t;});
  }

  <span style="color:#66d9ef">void</span> _enableEventReceiver() {
    _streamSubscription <span style="color:#f92672">=</span> _eventChannel.receiveBroadcastStream().listen(
      (<span style="color:#66d9ef">dynamic</span> event) {
        print(<span style="color:#e6db74">&#34;Received Event: </span><span style="color:#e6db74">$</span>event<span style="color:#e6db74">&#34;</span>);
        setState(() {
          text <span style="color:#f92672">=</span> event;
        });
      },
      onError: (<span style="color:#66d9ef">dynamic</span> error) {
        print(<span style="color:#e6db74">&#34;Received Error: </span><span style="color:#e6db74">${</span>error.message<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>);
      },
      cancelOnError: <span style="color:#66d9ef">true</span>
    );
  }

  <span style="color:#66d9ef">void</span> _disableEventReceiver() {
    <span style="color:#66d9ef">if</span> (_streamSubscription <span style="color:#f92672">!=</span> <span style="color:#66d9ef">null</span>) {
      _streamSubscription.cancel();
      _streamSubscription <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
    }
  }

  <span style="color:#960050;background-color:#1e0010">@</span>override
  <span style="color:#66d9ef">void</span> initState() {
    <span style="color:#66d9ef">super</span>.initState();
    _enableEventReceiver();
  }

  <span style="color:#960050;background-color:#1e0010">@</span>override
  <span style="color:#66d9ef">void</span> dispose() {
    <span style="color:#66d9ef">super</span>.dispose();
    _disableEventReceiver();
  }

  <span style="color:#960050;background-color:#1e0010">@</span>override
  Widget build(BuildContext context) {

    <span style="color:#66d9ef">return</span> Scaffold(
      appBar: AppBar(
        <span style="color:#75715e">// Here we take the value from the MyHomePage object that was created by
</span><span style="color:#75715e"></span>        <span style="color:#75715e">// the App.build method, and use it to set our appbar title.
</span><span style="color:#75715e"></span>        title: Text(widget.title),
      ),
      body: Center(
        child: Container(
          padding: EdgeInsets.all(<span style="color:#ae81ff">20</span>),
          child: PlatformViewLink(
            viewType: viewType,
            surfaceFactory: (BuildContext context, PlatformViewController controller) {
              <span style="color:#66d9ef">return</span> AndroidViewSurface(
                controller: controller,
                gestureRecognizers: <span style="color:#66d9ef">const</span> <span style="color:#f92672">&lt;</span>Factory<span style="color:#f92672">&lt;</span>OneSequenceGestureRecognizer<span style="color:#f92672">&gt;&gt;</span>{},
                hitTestBehavior: PlatformViewHitTestBehavior.opaque,
              );
            },
            onCreatePlatformView: (PlatformViewCreationParams params) {
              <span style="color:#66d9ef">return</span> PlatformViewsService.initSurfaceAndroidView(
                id: params.id,
                viewType: viewType,
                layoutDirection: TextDirection.ltr,
                creationParams: creationParams,
                creationParamsCodec: StandardMessageCodec(),
              )
                ..addOnPlatformViewCreatedListener(params.onPlatformViewCreated)
                ..create();
            },
          ),
        )
      ),
    );
  }
}
</code></pre></div><p>Hybrid Compositionã®éƒ¨åˆ†ã¯ã»ã¼ã»ã¼å…¬å¼ã®é€šã‚Šã§ã™ã€‚ä»Šå›ã¯**&ldquo;edit-text&rdquo;**ã¨ã„ã†åå‰ã§androidãƒã‚¤ãƒ†ã‚£ãƒ–ã®EditTextã‚’è¿”ã™PlatformViewã‚’ç™»éŒ²ã—ã¦ã„ã¾ã™ã€‚ä¸Šã®ã‚³ãƒ¼ãƒ‰ã§ã¯ãƒã‚¤ãƒ†ã‚£ãƒ–ã¨ã®ãƒ‡ãƒ¼ã‚¿ã®å—ã‘æ¸¡ã—ã«EventChannelã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚EventChannelã‚’é€šã—ã¦EditTextã®onTextChangedã‹ã‚‰å…¥åŠ›ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆã‚’å—ã‘å–ã‚Š_TextFieldDemoStateã®textã«ä¿å­˜ã—ã¾ã™ã€‚EventChannelã®ä½¿ã„æ–¹ã«é–¢ã—ã¦ã¯(ã“ã¡ã‚‰)[https://qiita.com/kurun_pan/items/6d63ebf1e894d3620b20]ã‚’å‚è€ƒã«ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚</p>
<p>æ¬¡ã«ãƒã‚¤ãƒ†ã‚£ãƒ–ã®ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚</p>
<p>MainActivity.kt</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">package</span> com.example.textfield_demo

<span style="color:#66d9ef">import</span> android.os.Handler
<span style="color:#66d9ef">import</span> io.flutter.embedding.android.FlutterActivity
<span style="color:#66d9ef">import</span> io.flutter.embedding.engine.FlutterEngine
<span style="color:#66d9ef">import</span> io.flutter.plugin.common.EventChannel
<span style="color:#66d9ef">import</span> io.flutter.plugin.common.EventChannel.EventSink
<span style="color:#66d9ef">import</span> io.flutter.plugin.common.EventChannel.StreamHandler
<span style="color:#66d9ef">import</span> io.flutter.plugins.GeneratedPluginRegistrant

<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MainActivity</span>: FlutterActivity() {
  <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">configureFlutterEngine</span>(flutterEngine: FlutterEngine) {
    GeneratedPluginRegistrant.registerWith(flutterEngine)

    flutterEngine
        .platformViewsController
        .registry
        .registerViewFactory(<span style="color:#e6db74">&#34;edit-text&#34;</span>, EditTextFactory(flutterEngine.dartExecutor.binaryMessenger))

    <span style="color:#66d9ef">var</span> channel: EventChannel = EventChannel(flutterEngine.dartExecutor.binaryMessenger, <span style="color:#e6db74">&#34;events/edit-text&#34;</span>)
    channel.setStreamHandler(
      <span style="color:#66d9ef">object</span>: StreamHandler {
        <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onListen</span>(arguments: Any?, events: EventSink) {
          FlutterEditText.eventSink = events
          Handler().postDelayed({
            events.success(<span style="color:#e6db74">&#34;Android&#34;</span>)
          }, <span style="color:#ae81ff">500</span>)
        }
        <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onCancel</span>(arguments: Any?) {}
      }
    )
  }
}
</code></pre></div><p>EditTextFactory.kt</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">package</span> com.example.textfield_demo

<span style="color:#66d9ef">import</span> android.content.Context
<span style="color:#66d9ef">import</span> android.view.View
<span style="color:#66d9ef">import</span> io.flutter.plugin.common.BinaryMessenger
<span style="color:#66d9ef">import</span> io.flutter.plugin.common.StandardMessageCodec
<span style="color:#66d9ef">import</span> io.flutter.plugin.platform.PlatformView
<span style="color:#66d9ef">import</span> io.flutter.plugin.platform.PlatformViewFactory

<span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">EditTextFactory</span>(<span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> messenger: BinaryMessenger) : PlatformViewFactory(StandardMessageCodec.INSTANCE) {
    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">create</span>(context: Context, id: Int, args: Any?): PlatformView {
        <span style="color:#66d9ef">val</span> creationParams = args <span style="color:#66d9ef">as</span> Map&lt;String?, Any?&gt;?
        <span style="color:#66d9ef">return</span> FlutterEditText(context, id, creationParams)
    }
}

</code></pre></div><p>FlutterEditText.kt</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">package</span> com.example.textfield_demo

<span style="color:#66d9ef">import</span> android.content.Context
<span style="color:#66d9ef">import</span> android.graphics.Color
<span style="color:#66d9ef">import</span> android.view.View
<span style="color:#66d9ef">import</span> android.view.ViewGroup
<span style="color:#66d9ef">import</span> android.widget.EditText
<span style="color:#66d9ef">import</span> android.text.TextWatcher
<span style="color:#66d9ef">import</span> android.text.Editable
<span style="color:#66d9ef">import</span> io.flutter.plugin.common.EventChannel.EventSink
<span style="color:#66d9ef">import</span> androidx.annotation.Nullable
<span style="color:#66d9ef">import</span> io.flutter.plugin.platform.PlatformView

<span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">CustomTextWatcher</span>: TextWatcher{
  <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">beforeTextChanged</span>(p0: CharSequence?, p1: Int, p2: Int, p3: Int) {}
  <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">afterTextChanged</span>(p0: Editable?) {}
}

<span style="color:#66d9ef">internal</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">FlutterEditText</span>(context: Context, id: Int, <span style="color:#a6e22e">@Nullable</span> creationParams: Map&lt;String?, Any?&gt;?) : PlatformView {

    <span style="color:#66d9ef">companion</span> <span style="color:#66d9ef">object</span> {
      <span style="color:#66d9ef">var</span> eventSink: EventSink? = <span style="color:#66d9ef">null</span>
    }

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">val</span> editTextLayout: ViewGroup
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">var</span> lastText: String = <span style="color:#e6db74">&#34;&#34;</span>

    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">getView</span>(): View {
        <span style="color:#66d9ef">return</span> editTextLayout
    }

    <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">dispose</span>() {}

    <span style="color:#66d9ef">init</span> {
      editTextLayout = (View.inflate(context, R.layout.flutter_edit_text, <span style="color:#66d9ef">null</span>) <span style="color:#66d9ef">as</span> ViewGroup)
      <span style="color:#66d9ef">var</span> editText: EditText = editTextLayout.getChildAt(<span style="color:#ae81ff">0</span>) <span style="color:#66d9ef">as</span> EditText
      editText.addTextChangedListener(<span style="color:#66d9ef">object</span>: CustomTextWatcher{
        <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onTextChanged</span>(s: CharSequence, start: Int, before: Int, count: Int) {
          <span style="color:#66d9ef">if</span> (!s.toString().equals(lastText)) {
            eventSink<span style="color:#f92672">?.</span>success(s.toString())
            lastText = s.toString()

          }
        }
      })
    }
}
</code></pre></div><p>Hybrid Compositionã®éƒ¨åˆ†ã«ã¤ã„ã¦ã¯ã»ã¨ã‚“ã©å…¬å¼ã®é€šã‚Šã§ã™ãŒã€èª¬æ˜ã—ãªã‘ã‚Œã°ã„ã‘ãªã„ç‚¹ãŒã„ãã¤ã‹ã‚ã‚Šã¾ã™ã€‚</p>
<p>ä¸€ã¤ç›®ãŒEventChannelã®ç™»éŒ²ã§ã™ã€‚ã“ã‚Œã¯MainActivityå†…ã§dartã‚µã‚¤ãƒ‰ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ£ãƒ³ãƒãƒ«ã¨åŒã˜åå‰ã§ç™»éŒ²ã—ã¦ã€onListenãŒå‘¼ã°ã‚Œã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§FlutterEditTextã«æ¸¡ã—ã¦ã‚ã’ã¾ã™ã€‚</p>
<p>äºŒã¤ç›®ãŒlayoutæ©Ÿèƒ½ã®åˆ©ç”¨ã§ã™ã€‚<code>View.inflate</code>ã‚’ä½¿ã†ã¨ã€android/app/src/main/res/layoutä»¥ä¸‹ã«ã‚ã‚‹xmlãƒ•ã‚¡ã‚¤ãƒ«å†…ã®è¨˜è¿°ã‹ã‚‰ãƒ“ãƒ¥ãƒ¼ã®ä½œæˆãŒã•ã‚Œã¾ã™ã€‚è©²å½“ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«flutter_edit_text.xmlã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚Šã€ä¸‹ã®ã‚ˆã†ã«è¨˜è¿°ã—ã¦ã‚„ã‚Šã¾ã™ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
<span style="color:#f92672">&lt;androidx.constraintlayout.widget.ConstraintLayout</span> <span style="color:#a6e22e">xmlns:android=</span><span style="color:#e6db74">&#34;http://schemas.android.com/apk/res/android&#34;</span>
    <span style="color:#a6e22e">xmlns:app=</span><span style="color:#e6db74">&#34;http://schemas.android.com/apk/res-auto&#34;</span>
    <span style="color:#a6e22e">xmlns:tools=</span><span style="color:#e6db74">&#34;http://schemas.android.com/tools&#34;</span>
    <span style="color:#a6e22e">android:layout_width=</span><span style="color:#e6db74">&#34;match_parent&#34;</span>
    <span style="color:#a6e22e">android:layout_height=</span><span style="color:#e6db74">&#34;match_parent&#34;</span>
    <span style="color:#a6e22e">tools:context=</span><span style="color:#e6db74">&#34;.MainActivity&#34;</span>
    <span style="color:#a6e22e">tools:showIn=</span><span style="color:#e6db74">&#34;@layout/flutter_edit_text&#34;</span><span style="color:#f92672">&gt;</span>

    <span style="color:#f92672">&lt;EditText</span>
        <span style="color:#a6e22e">android:id=</span><span style="color:#e6db74">&#34;@+id/flutter_edit_text&#34;</span>
        <span style="color:#a6e22e">android:layout_width=</span><span style="color:#e6db74">&#34;match_parent&#34;</span>
        <span style="color:#a6e22e">android:layout_height=</span><span style="color:#e6db74">&#34;wrap_content&#34;</span>
        <span style="color:#a6e22e">android:textIsSelectable=</span><span style="color:#e6db74">&#34;true&#34;</span>
        <span style="color:#a6e22e">android:inputType=</span><span style="color:#e6db74">&#34;textMultiLine&#34;</span>
        <span style="color:#a6e22e">android:focusable=</span><span style="color:#e6db74">&#34;true&#34;</span>
        <span style="color:#a6e22e">android:focusableInTouchMode=</span><span style="color:#e6db74">&#34;true&#34;</span>
        <span style="color:#a6e22e">android:minLines=</span><span style="color:#e6db74">&#34;6&#34;</span>
        <span style="color:#a6e22e">android:gravity=</span><span style="color:#e6db74">&#34;top&#34;</span>
        <span style="color:#a6e22e">android:hint=</span><span style="color:#e6db74">&#34;Enter Something&#34;</span>
    <span style="color:#f92672">/&gt;</span>

<span style="color:#f92672">&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;</span>
</code></pre></div><p>showInã®ã¨ã“ã‚ã§åå‰ã‚’æ±ºã‚ã€R.layout.flutter_edit_textã§ãƒ“ãƒ¥ãƒ¼ã‚’ä½œæˆã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚ã“ã‚Œã§ã€inflateã‚’ä½¿ã£ã¦ã“ã®ConstraintLayoutãŒå–å¾—ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã®ã§ã€FlutterEditTextã§ã¯ãã®å­ä¾›ã«ã‚ãŸã‚‹EditTextã‚’å–å¾—ã—ã¦è¨­å®šã‚’è¿½åŠ ã§è¡Œã£ã¦ã„ã¾ã™ã€‚</p>
<p>æœ€å¾ŒãŒã€EditTextã«listenerã‚’ç™»éŒ²ã—ã¦ã‚ã’ã¦ã„ã‚‹ã¨ã“ã‚ã§ã™ã€‚å…·ä½“çš„ã«ã¯ã“ã®è¾ºã§ã™ã­ã€‚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">      editText.addTextChangedListener(<span style="color:#66d9ef">object</span>: CustomTextWatcher{
        <span style="color:#66d9ef">override</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">onTextChanged</span>(s: CharSequence, start: Int, before: Int, count: Int) {
          <span style="color:#66d9ef">if</span> (!s.toString().equals(lastText)) {
            eventSink<span style="color:#f92672">?.</span>success(s.toString())
            lastText = s.toString()


          }
        }
      })
</code></pre></div><p>onTextChangedã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã—ã¦ã€å¤‰æ›´å¾Œã®ãƒ†ã‚­ã‚¹ãƒˆã‚’EventChannelã‚’é€šã˜ã¦ã€Flutterå´ã«é€šçŸ¥ã—ã¦ã„ã¾ã™ã€‚</p>
<p>é•·ããªã‚Šã¾ã—ãŸãŒã€æœ€çµ‚çš„ã«ã“ã†ãªã‚Šã¾ã™ã€‚</p>
<figure class="center">
    <img src="./native-text-field.gif" width="320"/> <figcaption>
            <h4>Androidãƒã‚¤ãƒ†ã‚£ãƒ–ã®EditText</h4>
        </figcaption>
</figure>

<p>ã‚„ã£ãŸãœ</p>
<h3 id="æ„Ÿæƒ³ã¨ã‹æ³¨æ„ã¨ã‹">æ„Ÿæƒ³ã¨ã‹ã€æ³¨æ„ã¨ã‹</h3>
<p>creationParamsã‚’ä½¿ãˆã°Flutterå´ã‹ã‚‰Mapå½¢å¼ã§æƒ…å ±ã‚’æƒ…å ±ã‚’é€ã‚Œã‚‹ã®ã§ã€å¿…è¦ãªã‚‰åˆ©ç”¨ã—ã¦ãã ã•ã„ã€‚ãŸã ã€æ–‡å­—åˆ—ã¨ã‹æ•´æ•°å€¤ã¨ã‹ã—ã‹é€ã‚Œãªã‹ã£ãŸæ°—ãŒã—ã¾ã™ã€‚Dartã§æ›¸ã„ãŸcallbacké–¢æ•°ã¨ã‹é€ã‚Œãªã„ã‹ãªãƒ¼ã¨æ€ã£ã¦è©¦ã—ã¦ã¿ãŸã‚“ã§ã™ãŒãƒ€ãƒ¡ã§ã—ãŸã€‚</p>
<p>EditTextã®ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆsetTextã¨ã‹ï¼‰ã‚’å‘¼ã³å‡ºã—ãŸã„ï¼ã£ã¦å ´åˆã¯MethodChannel, EditTextã§ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºç”Ÿã—ãŸã‚‰Dartã®å‡¦ç†ã‚’å®Ÿè¡Œã—ãŸã„ã£ã¦æ™‚ã¯EventChannelã‚’ä½¿ã†ã®ãŒã„ã„ã‚ˆã†ãªæ°—ãŒã—ã¾ã—ãŸã€‚ãªã‚“ã‹ã‚‚ã£ã¨ã„ã„æ–¹æ³•ã‚’çŸ¥ã£ã¦ã„ã‚‹æ–¹ãŒã„ã‚‰ã—ãŸã‚‰æ•™ãˆã¦ã„ãŸã ããŸã„ã§ã™ã€‚</p>
<p>Hybrid Compositionã¯ã¾ã ã¾ã æ–°ã—ã„æ©Ÿèƒ½ã§æƒ…å ±ã‚‚å°‘ãªã„ã®ã§ã‹ãªã‚Šè‹¦åŠ´ã—ã¾ã—ãŸã€‚Flutterã®çµ„ã¿è¾¼ã¿Widgetã§è§£æ±ºã§ãã‚‹ãªã‚‰ãã‚ŒãŒä¸€ç•ªæ¥½ã§ã„ã„ãªã¨æ€ã„ã¾ã—ãŸã€‚</p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p>2020å¹´åº¦XMLProéƒ¨é•· <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:2" role="doc-endnote">
<p>æ±äº¬å·¥ç§‘å¤§å­¦ç´…è¯ç¥­ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã¨ã„ã†ã“ã¨ã§è¨˜äº‹ã‚’æ›¸ã„ã¦ã„ã¾ã™ <a href="#fnref:2" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
<li id="fn:3" role="doc-endnote">
<p>éƒ¨å“¡ã®ã ã‚ŒãŒä½•æ—¥ç›®ã‚’ã‚„ã‚‹ã¨ã‹æ±ºã‚ã¦ãªã„ã®ã§ã‚¢ãƒ‰ãƒ™ãƒ³ãƒˆã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã¨ã¯å‘¼ã¹ã¾ã›ã‚“ãŒ <a href="#fnref:3" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>

		</div>
		<footer class="post__footer">
			
<div class="post__tags tags clearfix">
	<svg class="tags__badge icon icon-tag" width="16" height="16" viewBox="0 0 32 32"><path d="M32 19c0 1-1 2-1 2L21 31s-1 1-2 1-2-1-2-1L2 16c-1-1-1.4-2-1.4-2S0 12.5 0 11V3C0 1.5.8.8.8.8S1.5 0 3 0h8c1.5 0 3 .6 3 .6S15 1 16 2l15 15s1 1 1 2zM7 10a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"/></svg>
	<ul class="tags__list">
		<li class="tags__item">
			<a class="tags__link btn" href="/tags/flutter/" rel="tag">Flutter</a>
		</li>
	</ul>
</div>
		</footer>
	</article>
</main>

<div class="authorbox clearfix">
	<figure class="authorbox__avatar">
		<img alt="XMLPro avatar" src="/images/icon.png" class="avatar" height="90" width="90">
	</figure>
	<div class="authorbox__header">
		<span class="authorbox__name"></span>
	</div>
	<div class="authorbox__description">
		æ±äº¬å·¥ç§‘å¤§å­¦ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ã‚µãƒ¼ã‚¯ãƒ«ã§ã™ã€‚
	</div>
</div>

<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2020-10-13-1456/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;å‰ã®æŠ•ç¨¿</span>
			<p class="pager__title">Trend Micro CTF 2020ã«å‡ºãŸè©±</p>
		</a>
	</div>
</nav>


			</div>
			<aside class="sidebar"><div class="widget-search widget">
	<form class="widget-search__form" role="search" method="get" action="https://google.com/search">
		<label>
			<input class="widget-search__field" type="search" placeholder="æ¤œç´¢..." value="" name="q" aria-label="æ¤œç´¢...">
		</label>
		<input class="widget-search__submit" type="submit" value="Search">
		<input type="hidden" name="sitesearch" value="https://xmlpro.github.io" />
	</form>
</div>
<div class="widget-taglist widget">
	<h4 class="widget__title">ã‚¿ã‚°</h4>
	<div class="widget__content">
		<a class="widget-taglist__link widget__link btn" href="/tags/ctf/" title="CTF">CTF</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/flutter/" title="Flutter">Flutter</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/security/" title="Security">Security</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/trend-micro/" title="Trend Micro">Trend Micro</a>
		<a class="widget-taglist__link widget__link btn" href="/tags/yubikey/" title="Yubikey">Yubikey</a>
	</div>
</div>
</aside>
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2020 XMLPro.
			<span class="footer__copyright-credits">ã“ã®ã‚µã‚¤ãƒˆã¯ <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> ã¨ <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> ãƒ†ãƒ¼ãƒã§ç”Ÿæˆã•ã‚Œã¦ã„ã¾ã™ã€‚</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
</body>
</html>